package com.virtualbookstore.bookstoreapp;

import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;

import com.virtualbookstore.bookstoreapp.Entities.User;
import com.virtualbookstore.bookstoreapp.Services.UserService;

public class GetIdUtility {
	
	private final UserService userService;
	
	public GetIdUtility(UserService userService) {
		
		this.userService = userService;
		
	}
	
	public Long getCurrentUserId(){
    	
    	Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
    	
    	if(authentication==null || !authentication.isAuthenticated() || "AnonymousUser".equals(authentication.getPrincipal())) {
    		
    		throw new RuntimeException("User is not authenticated");
    		
    	}
    	
    	String email = authentication.getName();
    	User user = userService.findByEmail(email);
    	Long userId = user.getId();
    	
    	return userId;
    	
    }

}
