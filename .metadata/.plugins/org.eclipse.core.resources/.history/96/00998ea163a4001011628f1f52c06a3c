package com.virtualbookstore.bookstoreapp.Services;

import org.springframework.stereotype.Service;

import com.virtualbookstore.bookstoreapp.DTO.PaymentDTO;
import com.virtualbookstore.bookstoreapp.Entities.Book;
import com.virtualbookstore.bookstoreapp.Entities.Payment;
import com.virtualbookstore.bookstoreapp.Entities.User;
import com.virtualbookstore.bookstoreapp.repo.BookRepository;
import com.virtualbookstore.bookstoreapp.repo.UserRepository;

import jakarta.validation.Valid;

@Service
public class PaymentService {
	
	private final BookRepository bookRepository;
	private final BookService bookService;
	private final UserRepository userRepository;
	
	public PaymentService(BookRepository bookRepository, BookService bookService, UserRepository userRepository) {
		
		
		this.bookRepository=bookRepository;
		this.bookService=bookService;
		this.userRepository=userRepository;
		
	}

	public String process(@Valid PaymentDTO paymentDTO) {
		
		Long bookId = paymentDTO.getBookId();
		Long userId=paymentDTO.getUserId();
		int quantity = paymentDTO.getQuantity();
		Book book = bookRepository.findById(bookId).orElseThrow(() -> new RuntimeException("cannot find book"));
		double amount = paymentDTO.getAmount();
		User user = userRepository.findById(userId).orElseThrow(() -> new RuntimeException("User not found"));
		Boolean paymentBoolean = mockPaymentGateway(amount);
		
		if(!paymentBoolean) {
			
			Payment payment = Payment.
			
			throw new RuntimeException("Payment failed");
			
		}
		
		bookService.updateBookStock(bookId, book.getStock()-quantity);
		
	}

	private Boolean mockPaymentGateway(double amount) {
		
		if(amount>0)
			return true;
		return false;
		
	}

}
